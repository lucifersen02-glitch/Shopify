{% schema %}
{
  "name": "Product Main",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_zoom",
      "label": "Enable image zoom",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sku",
      "label": "Show SKU",
      "default": false
    }
  ]
}
{% endschema %}

<section class="product-main">
  <div class="container">
    <div class="product-main__wrapper">
      <!-- Product Images - Flipkart Style -->
      <div class="product-main__images">
        <div class="product-images">
          {% if product.images.size > 1 %}
            <!-- Vertical Thumbnails -->
            <div class="product-images__thumbnails-vertical">
              {% for image in product.images %}
                <button 
                  class="product-images__thumbnail {% if forloop.first %}active{% endif %}"
                  data-image-index="{{ forloop.index0 }}"
                  aria-label="View product image {{ forloop.index }}"
                >
                  <img 
                    src="{{ image | image_url: width: 150 }}" 
                    srcset="{{ image | image_url: width: 150 }} 2x"
                    alt="{{ image.alt | escape }}"
                    loading="lazy"
                  >
                </button>
              {% endfor %}
            </div>
          {% endif %}

          <!-- Main Image -->
          {% if product.featured_image %}
            <div class="product-images__main-wrapper">
              <div class="product-images__main" id="productImageContainer">
                <div class="product-images__zoom-lens" id="zoomLens"></div>
                <img 
                  src="{{ product.featured_image | image_url: width: 1200 }}" 
                  srcset="{{ product.featured_image | image_url: width: 600 }} 600w,
                          {{ product.featured_image | image_url: width: 900 }} 900w,
                          {{ product.featured_image | image_url: width: 1200 }} 1200w,
                          {{ product.featured_image | image_url: width: 1500 }} 1500w"
                  sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 600px"
                  alt="{{ product.featured_image.alt | escape }}"
                  class="product-images__featured"
                  id="ProductImage"
                  loading="eager"
                  data-zoom-image="{{ product.featured_image | image_url: width: 2000 }}"
                >
                <div class="product-images__zoom-result" id="zoomResult">
                  <img id="zoomResultImage" src="" alt="">
                </div>
              </div>
              
              <!-- Add to Cart & Buy Now Buttons Below Image -->
              <div class="product-images__actions">
                <button type="submit" form="product-form" class="button button--cart" id="AddToCartImage">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="currentColor" stroke-width="2"/>
                    <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="currentColor" stroke-width="2"/>
                    <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  ADD TO CART
                </button>
                <button type="button" class="button button--buy" onclick="document.getElementById('product-form').submit();">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  BUY NOW
                </button>
              </div>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Product Information -->
      <div class="product-main__info">
        <div class="product-info">
          {% if section.settings.show_vendor and product.vendor != blank %}
            <div class="product-info__vendor">
              <span>{{ product.vendor }}</span>
            </div>
          {% endif %}

          <h1 class="product-info__title">{{ product.title }}</h1>

          {% if section.settings.show_sku and product.selected_or_first_available_variant.sku != blank %}
            <div class="product-info__sku">
              <span class="product-info__sku-label">SKU:</span>
              <span class="product-info__sku-value">{{ product.selected_or_first_available_variant.sku }}</span>
            </div>
          {% endif %}

          <div class="product-info__price">
            <div class="product-price">
              <span class="product-price__current">{{ product.selected_or_first_available_variant.price | money }}</span>
              {% if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price %}
                <span class="product-price__compare">{{ product.selected_or_first_available_variant.compare_at_price | money }}</span>
                <span class="product-price__discount">
                  {{ product.selected_or_first_available_variant.compare_at_price | minus: product.selected_or_first_available_variant.price | times: 100.0 | divided_by: product.selected_or_first_available_variant.compare_at_price | round }}% off
                </span>
              {% endif %}
            </div>
          </div>

          <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" class="product-form" id="product-form">
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" id="product-variant-id">

            {% unless product.has_only_default_variant %}
              <div class="product-form__variants">
                {% for option in product.options_with_values %}
                  <div class="product-form__option">
                    <label class="product-form__option-label">{{ option.name }}</label>
                    <div class="product-form__option-values">
                      {% for value in option.values %}
                        <button
                          type="button"
                          class="product-form__option-value {% if option.selected_value == value %}active{% endif %}"
                          data-option="{{ option.name }}"
                          data-value="{{ value }}"
                        >
                          {{ value }}
                        </button>
                      {% endfor %}
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% endunless %}

            <div class="product-form__quantity">
              <label for="Quantity" class="product-form__quantity-label">Quantity</label>
              <div class="product-form__quantity-controls">
                <button type="button" class="product-form__quantity-btn" data-action="decrease" aria-label="Decrease quantity">-</button>
                <input 
                  type="number" 
                  id="Quantity" 
                  name="quantity" 
                  value="1" 
                  min="1" 
                  class="product-form__quantity-input"
                >
                <button type="button" class="product-form__quantity-btn" data-action="increase" aria-label="Increase quantity">+</button>
              </div>
            </div>

            <div class="product-form__actions">
              <button 
                type="submit" 
                name="add" 
                class="button button--primary product-form__submit"
                id="AddToCart"
                {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %}
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>
                  {% if product.selected_or_first_available_variant.available %}
                    ADD TO CART
                  {% else %}
                    Sold Out
                  {% endif %}
                </span>
              </button>
              <button type="button" class="button button--buy-now" onclick="document.getElementById('product-form').submit();">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                BUY NOW
              </button>
            </div>

            {% unless product.selected_or_first_available_variant.available %}
              <p class="product-form__sold-out">This product is currently sold out.</p>
            {% endunless %}
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
